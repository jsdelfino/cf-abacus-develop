#!/bin/bash

set -e

# Run demo client and performance tests on CF
if [ "$1" != "" ]; then
  CF_API=$1
fi
if [ "$1" != "" ]; then
  CF_USER=$2
fi
if [ "$1" != "" ]; then
  CF_PASSWORD=$3
fi
if [ "$1" != "" ]; then
  CF_ORG=$4
fi
if [ "$1" != "" ]; then
  CF_SPACE=$5
fi
if [ "$1" != "" ]; then
  CF_DOMAIN=$6
fi

# Login
cf api --skip-ssl-validation https://api.$CF_API
cf login -u $CF_USER -p $CF_PASSWORD -o $CF_ORG -s $CF_SPACE

# Start clean
npm run cfdelete

# Push and start the apps
npm run cfpush
npm run cfstart

# Run the demo
npm run demo -- --collector https://abacus-usage-collector.$CF_DOMAIN --reporting https://abacus-usage-reporting.$CF_DOMAIN

